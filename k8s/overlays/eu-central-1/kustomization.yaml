apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

<<<<<<< HEAD
<<<<<<< HEAD
namespace: teei-production-eu-central-1
=======
namespace: teei-eu-central-1
>>>>>>> origin/claude/ga-cutover-phase-one-0111mH9eWczXzBtpzUU5uUVU

namePrefix: eu-

commonLabels:
  environment: production
  region: eu-central-1
<<<<<<< HEAD
  data-residency: eu
  managed-by: kustomize
  cost-center: production-eu
  gdpr-compliant: "true"

commonAnnotations:
  cloud.google.com/region: eu-central-1
  cluster.teei.cloud/region: eu-central-1
  compliance.teei.cloud/residency: eu
  compliance.teei.cloud/gdpr: "strict"
  compliance.teei.cloud/schrems-ii: "compliant"

# Reference production overlay as base
=======
  managed-by: kustomize
  data-residency: eu
  gdpr-zone: "true"

commonAnnotations:
  gdpr-region: "true"
  cost-center: "eu-operations"
  sla-tier: "platinum"
  compliance: "gdpr,soc2"

# Reference all base services
>>>>>>> origin/claude/ga-cutover-phase-one-0111mH9eWczXzBtpzUU5uUVU
resources:
- ../../base/api-gateway
- ../../base/unified-profile
- ../../base/kintell-connector
- ../../base/buddy-service
- ../../base/upskilling-connector
- ../../base/q2q-ai
- ../../base/safety-moderation
- ../../base/analytics
- ../../base/buddy-connector
- ../../base/discord-bot
- ../../base/impact-calculator
- ../../base/impact-in
- ../../base/journey-engine
- ../../base/notifications
- ../../base/reporting
- ../../base/corp-cockpit-astro
- ../../base/observability
<<<<<<< HEAD
- ../../base/ingress.yaml
- ../../base/network-policies.yaml

# Regional ConfigMap with GDPR settings
=======

# Ingress and NetworkPolicies
- ../../base/ingress.yaml
- ../../base/network-policies.yaml

# Regional security policies
- mtls-strict.yaml
- admission-policies.yaml
- gdpr-policies.yaml

# ConfigMap generator for EU Central region
>>>>>>> origin/claude/ga-cutover-phase-one-0111mH9eWczXzBtpzUU5uUVU
configMapGenerator:
- name: env-config
  literals:
  - ENVIRONMENT=production
  - REGION=eu-central-1
  - LOG_LEVEL=warn
  - ENABLE_DEBUG=false
  - DATA_RESIDENCY=eu
<<<<<<< HEAD
  - GDPR_STRICT_MODE=true
  - SCHREMS_II_COMPLIANT=true
  - BACKUP_REGION=eu-west-1
  - PRIMARY_DB_ENDPOINT=postgres-eu-central-1.teei.internal
  - CLICKHOUSE_ENDPOINT=clickhouse-eu-central-1.teei.internal
  - NATS_ENDPOINT=nats://nats-eu-central-1.teei.internal:4222
  - DATA_TRANSFER_RESTRICTIONS=eu-only
  - PII_ENCRYPTION_AT_REST=aes-256-gcm

# Regional patches with GDPR enforcement
patchesStrategicMerge:
- replica-patch.yaml
- resource-limits-patch.yaml
- topology-spread-patch.yaml
- regional-endpoints-patch.yaml
- pod-disruption-budgets.yaml
- gdpr-network-policy-patch.yaml

# Production image tags
=======
  - GDPR_ENABLED=true
  - DATA_RETENTION_DAYS=365
  - PII_ENCRYPTION_REQUIRED=true
  - OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector.observability.svc.cluster.local:4317
  - POSTGRES_REGION=eu-central-1
  - CLICKHOUSE_REGION=eu-central-1
  - NATS_REGION=eu-central-1

# Patches for production EU region
patchesStrategicMerge:
- replica-patch.yaml
- resource-limits-patch.yaml
- security-patch.yaml
- ingress-patch.yaml
- residency-patch.yaml
- gdpr-patch.yaml

# Image tags for production (use specific version tags with digest)
>>>>>>> origin/claude/ga-cutover-phase-one-0111mH9eWczXzBtpzUU5uUVU
images:
- name: ghcr.io/henrigkroine/teei-api-gateway
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-unified-profile
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-kintell-connector
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-buddy-service
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-upskilling-connector
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-q2q-ai
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-safety-moderation
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-analytics
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-buddy-connector
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-discord-bot
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-impact-calculator
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-impact-in
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-journey-engine
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-notifications
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-reporting
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-corp-cockpit
  newTag: v1.0.0
<<<<<<< HEAD
=======

# Replica configuration for EU region
replicas:
- name: teei-api-gateway
  count: 4
- name: teei-unified-profile
  count: 3
- name: teei-reporting
  count: 3
- name: teei-analytics
  count: 3
>>>>>>> origin/claude/ga-cutover-phase-one-0111mH9eWczXzBtpzUU5uUVU
=======
# EU Central 1 Region Overlay
# Extends production overlay with EU-specific configurations

namespace: teei-eu-central-1

namePrefix: eu-

# Common labels for all resources in this region
commonLabels:
  teei.platform/region: eu-central-1
  topology.kubernetes.io/region: eu-central-1
  topology.kubernetes.io/zone: eu-central-1a
  environment: production
  managed-by: kustomize
  deployment-region: eu

# Common annotations
commonAnnotations:
  teei.platform/region-code: eu-central-1
  teei.platform/region-name: "Europe (Frankfurt)"
  teei.platform/data-residency: eu
  teei.platform/gdpr-compliant: "true"

# Reference production overlay as base
resources:
- ../production
- ../../base/postgres

# ConfigMap generator for EU region-specific environment
configMapGenerator:
- name: region-config
  literals:
  - REGION=eu-central-1
  - REGION_NAME=Europe (Frankfurt)
  - DATA_RESIDENCY=eu
  - TIMEZONE=Europe/Berlin
  - LOCALE_DEFAULT=en-GB
  - GDPR_MODE=strict
  - CLOUDFRONT_DISTRIBUTION_ID=E1234567890ABC
  - S3_BUCKET_REGION=eu-central-1

# Region-specific patches
patchesStrategicMerge:
- namespace-patch.yaml
- resource-limits-patch.yaml
- ingress-patch.yaml
- networkpolicy-patch.yaml
- postgres-patch.yaml

# Patches for adding region topology and affinity
patches:
- target:
    kind: Deployment
  patch: |-
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: not-important
    spec:
      template:
        metadata:
          labels:
            teei.platform/region: eu-central-1
        spec:
          affinity:
            nodeAffinity:
              requiredDuringSchedulingIgnoredDuringExecution:
                nodeSelectorTerms:
                - matchExpressions:
                  - key: topology.kubernetes.io/region
                    operator: In
                    values:
                    - eu-central-1
            podAntiAffinity:
              preferredDuringSchedulingIgnoredDuringExecution:
              - weight: 100
                podAffinityTerm:
                  labelSelector:
                    matchExpressions:
                    - key: app
                      operator: In
                      values:
                      - teei-api-gateway
                      - teei-corp-cockpit
                  topologyKey: kubernetes.io/hostname
          topologySpreadConstraints:
          - maxSkew: 1
            topologyKey: topology.kubernetes.io/zone
            whenUnsatisfiable: DoNotSchedule
            labelSelector:
              matchLabels:
                teei.platform/region: eu-central-1
>>>>>>> origin/claude/phaseG-global-ga-multiregion-017uvLqAucExNFGykX9bSDSY
