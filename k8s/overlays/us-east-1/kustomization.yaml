apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: teei-us-east-1

namePrefix: us-

commonLabels:
  environment: production
  region: us-east-1
  managed-by: kustomize
  data-residency: us

commonAnnotations:
  gdpr-region: "false"
  cost-center: "us-operations"
  sla-tier: "platinum"

# Reference all base services
resources:
- ../../base/api-gateway
- ../../base/unified-profile
- ../../base/kintell-connector
- ../../base/buddy-service
- ../../base/upskilling-connector
- ../../base/q2q-ai
- ../../base/safety-moderation
- ../../base/analytics
- ../../base/buddy-connector
- ../../base/discord-bot
- ../../base/impact-calculator
- ../../base/impact-in
- ../../base/journey-engine
- ../../base/notifications
- ../../base/reporting
- ../../base/corp-cockpit-astro
- ../../base/observability

# Ingress and NetworkPolicies
- ../../base/ingress.yaml
- ../../base/network-policies.yaml

# Regional security policies
- mtls-strict.yaml
- admission-policies.yaml

# ConfigMap generator for US East region
configMapGenerator:
- name: env-config
  literals:
  - ENVIRONMENT=production
  - REGION=us-east-1
  - LOG_LEVEL=warn
  - ENABLE_DEBUG=false
  - DATA_RESIDENCY=us
  - OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector.observability.svc.cluster.local:4317
  - POSTGRES_REGION=us-east-1
  - CLICKHOUSE_REGION=us-east-1
  - NATS_REGION=us-east-1

# Patches for production US region
patchesStrategicMerge:
- replica-patch.yaml
- resource-limits-patch.yaml
- security-patch.yaml
- ingress-patch.yaml
- residency-patch.yaml

# Image tags for production (use specific version tags with digest)
images:
- name: ghcr.io/henrigkroine/teei-api-gateway
  newTag: v1.0.0
  digest: sha256:placeholder  # Replace with actual digest post-build
- name: ghcr.io/henrigkroine/teei-unified-profile
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-kintell-connector
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-buddy-service
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-upskilling-connector
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-q2q-ai
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-safety-moderation
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-analytics
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-buddy-connector
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-discord-bot
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-impact-calculator
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-impact-in
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-journey-engine
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-notifications
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-reporting
  newTag: v1.0.0
- name: ghcr.io/henrigkroine/teei-corp-cockpit
  newTag: v1.0.0

# Replica configuration for US region (higher traffic)
replicas:
- name: teei-api-gateway
  count: 5
- name: teei-unified-profile
  count: 4
- name: teei-reporting
  count: 3
- name: teei-analytics
  count: 3
