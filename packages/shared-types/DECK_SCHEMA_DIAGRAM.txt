TEEI CSR Platform - Deck Schema Architecture
=============================================

┌─────────────────────────────────────────────────────────────────────────────┐
│                          DeckDefinition (Root Schema)                        │
├─────────────────────────────────────────────────────────────────────────────┤
│ • id: UUID                                                                   │
│ • companyId: UUID                                                            │
│ • template: DeckTemplate (quarterly | annual | investor | impact-deep-dive) │
│ • periodStart: DateTime                                                      │
│ • periodEnd: DateTime                                                        │
│ • locale: Locale (en | es | fr | uk | no)                                   │
│ • theme: DeckTheme ────────────────────────┐                                │
│ • slides: SlideBlock[] ─────────────────┐  │                                │
│ • metadata: DeckMetadata ─────────────┐ │  │                                │
│ • coverSlide?: CoverSlide (optional)  │ │  │                                │
│ • watermark?: Watermark (optional)    │ │  │                                │
│ • footerText?: string (optional)      │ │  │                                │
└───────────────────────────────────────┼─┼──┼────────────────────────────────┘
                                        │ │  │
                ┌───────────────────────┘ │  │
                │                         │  │
                ▼                         │  │
┌─────────────────────────────────┐      │  │
│      DeckMetadata               │      │  │
├─────────────────────────────────┤      │  │
│ • createdAt: DateTime           │      │  │
│ • createdBy: UUID               │      │  │
│ • updatedAt?: DateTime          │      │  │
│ • updatedBy?: UUID              │      │  │
│ • estimatedPages: number        │      │  │
│ • citationCount: number         │      │  │
│ • version: number (default: 1)  │      │  │
│ • status: Status                │      │  │
│   - draft                       │      │  │
│   - review                      │      │  │
│   - approved                    │      │  │
│   - archived                    │      │  │
│ • approvedAt?: DateTime         │      │  │
│ • approvedBy?: UUID             │      │  │
│ • exportedAt?: DateTime         │      │  │
│ • exportFormat?: pptx | pdf     │      │  │
└─────────────────────────────────┘      │  │
                                         │  │
                ┌────────────────────────┘  │
                │                           │
                ▼                           │
┌─────────────────────────────────┐        │
│         SlideBlock              │        │
├─────────────────────────────────┤        │
│ • id: UUID                      │        │
│ • type: SlideBlockType          │        │
│   - title                       │        │
│   - content                     │        │
│   - chart                       │        │
│   - table                       │        │
│   - image                       │        │
│   - two-column                  │        │
│ • title?: string                │        │
│ • content?: string              │        │
│ • citationIds: UUID[]           │        │
│ • chartConfig?: any ────────────┼───┐    │
│ • tableData?: TableData ────────┼─┐ │    │
│ • imageUrl?: URL                │ │ │    │
│ • leftColumn?: string           │ │ │    │
│ • rightColumn?: string          │ │ │    │
│ • order: number                 │ │ │    │
│ • speakerNotes?: string         │ │ │    │
│ • metadata?: Record<any>        │ │ │    │
└─────────────────────────────────┘ │ │    │
                                    │ │    │
            ┌───────────────────────┘ │    │
            │                         │    │
            ▼                         │    │
┌─────────────────────────────────┐  │    │
│         TableData               │  │    │
├─────────────────────────────────┤  │    │
│ • headers: string[]             │  │    │
│ • rows: string[][]              │  │    │
└─────────────────────────────────┘  │    │
                                     │    │
            ┌────────────────────────┘    │
            │                             │
            ▼                             │
┌─────────────────────────────────┐      │
│       Chart.js Config           │      │
├─────────────────────────────────┤      │
│ • type: line | bar | pie | ...  │      │
│ • data: { labels, datasets }    │      │
│ • options: { ... }              │      │
└─────────────────────────────────┘      │
                                         │
                ┌────────────────────────┘
                │
                ▼
┌─────────────────────────────────┐
│          DeckTheme              │
├─────────────────────────────────┤
│ • primaryColor: #RRGGBB         │
│ • secondaryColor: #RRGGBB       │
│ • accentColor: #RRGGBB          │
│ • logoUrl?: URL                 │
│ • fontFamily?: string           │
│ • backgroundImageUrl?: URL      │
└─────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════
                              API Request/Response Flow
═══════════════════════════════════════════════════════════════════════════════

GENERATION WORKFLOW:
────────────────────

Client                    API                     Service
  │                        │                         │
  │ GenerateDeckRequest    │                         │
  ├───────────────────────►│                         │
  │ • companyId            │ validateGenerate        │
  │ • template             │ DeckRequest()           │
  │ • period               ├────────────────────────►│
  │ • locale               │                         │
  │ • theme (optional)     │                    ┌────┴────┐
  │ • options              │                    │ Generate│
  │   - includeCharts      │                    │  Deck   │
  │   - includeEvidence    │                    │ Content │
  │   - maxSlides          │                    └────┬────┘
  │   - tone               │                         │
  │                        │  DeckDefinition          │
  │                        │◄─────────────────────────┤
  │                        │                         │
  │ GenerateDeckResponse   │                         │
  │◄───────────────────────┤                         │
  │ • deckId               │                         │
  │ • deck                 │                         │
  │ • generatedAt          │                         │
  │                        │                         │


EXPORT WORKFLOW:
────────────────

Client                    API                     Service
  │                        │                         │
  │ ExportDeckRequest      │                         │
  ├───────────────────────►│                         │
  │ • deckId               │ validateExport          │
  │ • format (pptx|pdf)    │ DeckRequest()           │
  │ • options              ├────────────────────────►│
  │   - includeWatermark   │                         │
  │   - includeEvidence    │                    ┌────┴────┐
  │   - quality            │                    │ Generate│
  │                        │                    │ PPTX/PDF│
  │                        │                    └────┬────┘
  │                        │                         │
  │                        │  ExportDeckResponse     │
  │                        │◄─────────────────────────┤
  │ ExportDeckResponse     │                         │
  │◄───────────────────────┤                         │
  │ • deckId               │                         │
  │ • format               │                         │
  │ • downloadUrl          │                         │
  │ • fileSize             │                         │
  │ • expiresAt            │                         │
  │ • checksum (SHA-256)   │                         │
  │ • metadata             │                         │
  │                        │                         │


═══════════════════════════════════════════════════════════════════════════════
                              Validation Helpers
═══════════════════════════════════════════════════════════════════════════════

┌────────────────────────────────────────────────────────────────────────────┐
│                         Validation Helper Functions                        │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  validateDeckDefinition(data)         → DeckDefinition | throws ZodError   │
│  safeParseDeckDefinition(data)        → { success, data } | { success,     │
│                                           error }                           │
│  isValidTemplate(template)            → boolean                            │
│  isValidSlideBlockType(type)          → boolean                            │
│  validateSlideBlock(data)             → SlideBlock | throws ZodError        │
│  validateDeckTheme(data)              → DeckTheme | throws ZodError         │
│  validateGenerateDeckRequest(data)    → GenerateDeckRequest | throws       │
│  validateExportDeckRequest(data)      → ExportDeckRequest | throws         │
│                                                                             │
└────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════
                              Integration Points
═══════════════════════════════════════════════════════════════════════════════

┌──────────────────┐
│  Evidence Types  │
│  (evidence.ts)   │
└────────┬─────────┘
         │
         │ citationIds: UUID[]
         │
         ▼
┌─────────────────────────┐
│    Deck Definitions     │      ┌──────────────────┐
│      (deck.ts)          │◄─────┤  Reporting Types │
│                         │      │  (reporting.ts)  │
│  Links to:              │      └──────────────────┘
│  • Evidence citations   │               │
│  • Report metrics       │               │
│  • Q2Q data sources     │      CSRD reporting,
│                         │      citation tracking
└─────────────────────────┘
         │
         │ Export generation
         ▼
┌──────────────────┐
│  PPTX Generator  │      Uses pptxgenjs, puppeteer
│  PDF Generator   │      Watermarking, checksums
└──────────────────┘


═══════════════════════════════════════════════════════════════════════════════
                          Test Coverage Visualization
═══════════════════════════════════════════════════════════════════════════════

deck.ts Coverage: 100% ████████████████████████████████████████████

Lines:      100% (259/259)  ████████████████████████████████████████████
Branches:   100% (N/A)      ████████████████████████████████████████████
Functions:  100% (8/8)      ████████████████████████████████████████████
Statements: 100% (259/259)  ████████████████████████████████████████████

Tests: 65 passing
  ✓ DeckTemplateSchema (2 tests)
  ✓ SlideBlockTypeSchema (2 tests)
  ✓ SlideBlockSchema (9 tests)
  ✓ DeckThemeSchema (7 tests)
  ✓ DeckMetadataSchema (6 tests)
  ✓ DeckDefinitionSchema (10 tests)
  ✓ GenerateDeckRequestSchema (7 tests)
  ✓ ExportDeckRequestSchema (4 tests)
  ✓ ExportDeckResponseSchema (1 test)
  ✓ Validation Helpers (16 tests)
  ✓ Type Inference (3 tests)


═══════════════════════════════════════════════════════════════════════════════
