---
/**
 * Campaign List Page
 *
 * SWARM 6: Agent 6.1 - campaign-list-ui
 * Displays all campaigns for a company with filtering, sorting, and upsell badges
 */
import BaseLayout from '../../../../../layouts/BaseLayout.astro';
import { hasPermission } from '../../../../../utils/rbac';
import CampaignList from '../../../../../components/campaigns/CampaignList';
import PageHeader from '../../../../../components/ui/PageHeader';

// Extract route parameters
const { lang, companyId } = Astro.params;
const user = Astro.locals.user;
const tenantContext = Astro.locals.tenantContext;

// Middleware handles auth/tenant validation, but double-check
if (!user || !tenantContext) {
  return Astro.redirect('/login');
}

// Verify user has campaign access
if (!hasPermission(user.role, 'VIEW_CAMPAIGNS')) {
  return Astro.redirect(`/${lang}/cockpit/401?reason=insufficient_permissions`);
}

const canManageCampaigns = hasPermission(user.role, 'MANAGE_CAMPAIGNS');
---

<BaseLayout title="Campaigns - TEEI Corporate Cockpit" lang={lang}>
  <PageHeader
    title="Campaigns"
    subtitle="Manage and monitor your social impact campaigns"
    breadcrumbs={[
      { label: 'Dashboard', href: `/${lang}/cockpit/${companyId}` },
      { label: 'Campaigns' },
    ]}
    showCreateButton={canManageCampaigns}
    createButtonHref={`/${lang}/cockpit/${companyId}/campaigns/new`}
    createButtonLabel="Create Campaign"
    client:load
  />

  <div class="campaigns-container">
    <CampaignList
      companyId={companyId}
      lang={lang}
      canManage={canManageCampaigns}
      client:load
    />
  </div>
</BaseLayout>

<style>
  .campaigns-container {
    background-color: var(--color-surface);
    border-radius: var(--card-radius);
    box-shadow: var(--shadow-card);
    border: 1px solid var(--color-border);
    padding: var(--space-24);
    animation: pageEnter 0.3s var(--ease-out) backwards;
    animation-delay: 50ms;
  }

  @keyframes pageEnter {
    from {
      opacity: 0;
      transform: translateY(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @media (max-width: 768px) {
    .campaigns-container {
      padding: var(--space-16);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .campaigns-container {
      animation: none;
    }
  }
</style>
