# TEEI CSR Platform - Environment Configuration
# Phase B Security Hardening - Complete Configuration Template
# Copy this file to .env and fill in your actual values
# NEVER commit .env to version control

# ==============================================================================
# GENERAL SETTINGS
# ==============================================================================

NODE_ENV=development
# Options: development, staging, production

# ==============================================================================
# DATABASE
# ==============================================================================

DATABASE_URL=postgresql://teei:teei_dev_password@localhost:5432/teei_platform
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=10

# ==============================================================================
# NATS EVENT BUS
# ==============================================================================

NATS_URL=nats://localhost:4222
NATS_CLUSTER_ID=teei-cluster
NATS_USER=
NATS_PASSWORD=

# ==============================================================================
# JWT AUTHENTICATION (PHASE B: RS256 UPGRADE)
# ==============================================================================

# DEPRECATED: HS256 JWT Secret (Phase A - kept for backward compatibility)
# MUST be the same across both TEEI Website and Corp Cockpit
JWT_SECRET=change_me_in_production_use_strong_secret_minimum_32_characters
JWT_EXPIRES_IN=7d
JWT_ISSUER=teei-platform

# Cookie Domain (environment-specific)
# Production: .theeducationalequalityinstitute.org
# Staging: .teei.no
# Local: leave empty or set to localhost
COOKIE_DOMAIN=

# NEW: RS256 JWT Configuration (Phase B)
JWT_KEYS_DIR=.keys
# Directory containing jwt-private.pem and jwt-public.pem
# Generate keys: npm run generate-jwt-keys

# ==============================================================================
# OIDC SSO CONFIGURATION (PHASE B)
# ==============================================================================

# Google OAuth 2.0 / OIDC
GOOGLE_CLIENT_ID=
# Get from: https://console.cloud.google.com/apis/credentials
GOOGLE_CLIENT_SECRET=
GOOGLE_REDIRECT_URI=http://localhost:3000/auth/google/callback
GOOGLE_HOSTED_DOMAIN=
# Optional: Restrict to specific Google Workspace domain

# Azure AD / Microsoft Identity Platform
AZURE_CLIENT_ID=
# Get from: https://portal.azure.com/ -> Azure AD -> App registrations
AZURE_CLIENT_SECRET=
AZURE_TENANT_ID=
AZURE_REDIRECT_URI=http://localhost:3000/auth/azure/callback

# OIDC Session Secret
OIDC_SESSION_SECRET=
# Generate: openssl rand -hex 32

# ==============================================================================
# WEBHOOK SECURITY (PHASE B)
# ==============================================================================

# Kintell Webhook Secret (HMAC-SHA256)
KINTELL_WEBHOOK_SECRET=
# Obtain from Kintell dashboard -> Webhooks -> Signing Secret

# Upskilling Platforms Webhook Secret
UPSKILLING_WEBHOOK_SECRET=
# Obtain from LinkedIn Learning / Coursera / Udemy webhook settings

# ==============================================================================
# SERVICE-TO-SERVICE AUTHENTICATION (PHASE B)
# ==============================================================================

# Service Keys Directory (for inter-service JWT)
SERVICE_KEYS_DIR=.keys
# Directory containing service-private.pem and service-public.pem

# Service Identity
SERVICE_ID=api-gateway
SERVICE_TYPE=gateway
SERVICE_ENVIRONMENT=development

# Allowed Services (comma-separated whitelist)
ALLOWED_SERVICES=profile-service,kintell-connector,buddy-service,upskilling-connector,q2q-service,safety-service

# ==============================================================================
# WEB APPLICATION FIREWALL (PHASE B)
# ==============================================================================

WAF_ENABLED=true

# Rate Limiting
WAF_RATE_LIMIT_GLOBAL=100
# Maximum requests per minute (global)
WAF_RATE_LIMIT_AUTHENTICATED=500
WAF_RATE_LIMIT_AUTH_ENDPOINTS=10

# Payload Limits (bytes)
WAF_PAYLOAD_JSON_MAX=1048576
# 1 MB - Maximum JSON payload size
WAF_PAYLOAD_MULTIPART_MAX=10485760
# 10 MB - Maximum file upload size
WAF_PAYLOAD_URLENCODED_MAX=102400
# 100 KB - Maximum form data size

# IP Blocklist (comma-separated)
WAF_BLOCKLIST_IPS=
# Example: 192.168.1.100,10.0.0.5

# Suspicious Pattern Detection
WAF_PATTERN_DETECTION=true
WAF_PATTERN_BLOCK=false

# ==============================================================================
# REDIS (for distributed rate limiting)
# ==============================================================================

REDIS_URL=
# Optional: Redis for distributed rate limiting
# Example: redis://localhost:6379
# Leave empty to use in-memory (single instance only)

# ==============================================================================
# SERVICE PORTS
# ==============================================================================

PORT_API_GATEWAY=3000
PORT_UNIFIED_PROFILE=3001
PORT_KINTELL_CONNECTOR=3002
PORT_BUDDY_SERVICE=3003
PORT_UPSKILLING_CONNECTOR=3004
PORT_Q2Q_AI=3005
PORT_SAFETY_MODERATION=3006
PORT_REPORTING=3007
PORT_ANALYTICS=3008
PORT_NOTIFICATIONS=3009
PORT_IMPACT_IN=3010
PORT_JOURNEY_ENGINE=3011

# ==============================================================================
# LOGGING
# ==============================================================================

LOG_LEVEL=info
LOG_FORMAT=json

# ==============================================================================
# Q2Q AI SERVICE
# ==============================================================================

Q2Q_MODEL_PROVIDER=openai
Q2Q_API_KEY=placeholder
Q2Q_MODEL_PATH=./models/q2q-classifier
Q2Q_CONFIDENCE_THRESHOLD=0.7

# ==============================================================================
# SAFETY/MODERATION SERVICE
# ==============================================================================

SAFETY_ENABLED=true
SAFETY_AUTO_FLAG_THRESHOLD=0.8
OPENAI_API_KEY=
# For content moderation API

# ==============================================================================
# CORS
# ==============================================================================

# CORS Origins (comma-separated)
# Production: https://theeducationalequalityinstitute.org,https://dashboard.theeducationalequalityinstitute.org
# Staging: https://staging.teei.no,https://dashboard.staging.teei.no
# Local: http://localhost:3000,http://localhost:4321
CORS_ORIGIN=http://localhost:3000,http://localhost:4321

# ==============================================================================
# EXTERNAL API CREDENTIALS (Connectors)
# ==============================================================================

# Kintell API
KINTELL_API_URL=https://api.kintell.com
KINTELL_API_KEY=

# Buddy Platform API
BUDDY_API_URL=https://api.buddy.com
BUDDY_API_KEY=

# LinkedIn Learning API
LINKEDIN_API_URL=https://api.linkedin.com/v2
LINKEDIN_CLIENT_ID=
LINKEDIN_CLIENT_SECRET=

# ==============================================================================
# IMPACT-IN CONNECTORS (Worker 2)
# ==============================================================================

# Benevity API Configuration
BENEVITY_API_URL=https://api.benevity.com
# Obtain from: Benevity dashboard -> API Settings
BENEVITY_API_KEY=
# Obtain from: Benevity dashboard -> Webhooks -> Signing Secret
BENEVITY_SIGNATURE_SECRET=

# Goodera API Configuration (OAuth 2.0)
GOODERA_API_URL=https://api.goodera.com
GOODERA_TOKEN_URL=https://api.goodera.com/oauth/token
# Obtain from: Goodera dashboard -> API Credentials
GOODERA_CLIENT_ID=
GOODERA_CLIENT_SECRET=

# Workday API Configuration
WORKDAY_API_URL=https://wd2-impl-services1.workday.com
# Obtain from: Workday tenant settings
WORKDAY_TENANT_ID=
# Protocol: 'soap' (legacy) or 'rest' (modern)
WORKDAY_PROTOCOL=rest

# SOAP Authentication (if WORKDAY_PROTOCOL=soap)
WORKDAY_USERNAME=
WORKDAY_PASSWORD=

# REST Authentication (if WORKDAY_PROTOCOL=rest)
# Obtain from: Workday -> API Clients -> OAuth 2.0 Clients
WORKDAY_CLIENT_ID=
WORKDAY_CLIENT_SECRET=
WORKDAY_TOKEN_URL=

# ==============================================================================
# NOTIFICATIONS SERVICE
# ==============================================================================

# SendGrid Email Provider
SENDGRID_API_KEY=
# Obtain from: https://app.sendgrid.com/settings/api_keys
SENDGRID_FROM_EMAIL=noreply@teei-platform.com
SENDGRID_FROM_NAME=TEEI Platform

# Twilio SMS Provider (stub - not yet implemented)
TWILIO_ACCOUNT_SID=
# Obtain from: https://www.twilio.com/console
TWILIO_AUTH_TOKEN=
TWILIO_PHONE_NUMBER=

# Firebase Cloud Messaging (stub - not yet implemented)
FIREBASE_SERVICE_ACCOUNT_JSON=
# Path to Firebase service account JSON file

# Notification Rate Limits
EMAIL_DAILY_LIMIT=1000
SMS_DAILY_LIMIT=100
PUSH_DAILY_LIMIT=10000

# ==============================================================================
# REPORTING SERVICE
# ==============================================================================

# LLM Provider for AI Report Generation
LLM_PROVIDER=openai
# Options: openai, anthropic
LLM_MODEL=gpt-4-turbo
# OpenAI: gpt-4-turbo, gpt-4, gpt-3.5-turbo
# Anthropic: claude-3-opus, claude-3-sonnet
ANTHROPIC_API_KEY=

# ==============================================================================
# ANALYTICS SERVICE (ClickHouse + Redis)
# ==============================================================================

# ClickHouse Configuration
CLICKHOUSE_URL=http://localhost:8123
# ClickHouse HTTP interface
CLICKHOUSE_USER=teei
CLICKHOUSE_PASSWORD=teei_dev_password
CLICKHOUSE_DB=teei_analytics

# Redis Configuration (for analytics caching)
# Note: This overrides the Redis URL from the WAF section if specified
REDIS_URL=redis://localhost:6379

# Analytics Performance Tuning
ANALYTICS_SYNC_INTERVAL_MS=900000
# Default: 900000 (15 minutes) - How often to sync Postgres â†’ ClickHouse
ANALYTICS_BATCH_SIZE=1000
# Default: 1000 - Rows per batch for ingestion
ANALYTICS_CACHE_TTL_TRENDS=3600
# Default: 3600 (1 hour) - Cache TTL for trends queries
ANALYTICS_CACHE_TTL_BENCHMARKS=21600
# Default: 21600 (6 hours) - Cache TTL for benchmarks queries

# Query Budget Defaults (per tenant)
ANALYTICS_DAILY_QUERY_LIMIT=10000
# Default: 10000 queries per day per company
ANALYTICS_MONTHLY_QUERY_LIMIT=100000
# Default: 100000 queries per month per company

# ==============================================================================
# OBSERVABILITY (Future Phase)
# ==============================================================================

# Sentry
SENTRY_DSN=
SENTRY_ENVIRONMENT=development

# OpenTelemetry
OTEL_ENABLED=false
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318

# ==============================================================================
# PHASE B SECURITY SETUP GUIDE
# ==============================================================================
#
# 1. Generate JWT RSA Keys:
#    npm run generate-jwt-keys
#
# 2. Generate OIDC Session Secret:
#    openssl rand -hex 32
#
# 3. Generate Service Auth Keys:
#    npm run generate-service-keys
#
# 4. Obtain Webhook Secrets from providers
#
# 5. Configure OIDC Providers:
#    - Google: https://console.cloud.google.com/apis/credentials
#    - Azure: https://portal.azure.com/
#
# 6. Production Checklist:
#    - [ ] All secrets in vault (not .env)
#    - [ ] RS256 JWT enabled
#    - [ ] Webhook secrets configured
#    - [ ] OIDC providers registered
#    - [ ] WAF enabled
#    - [ ] Redis for distributed rate limiting
#    - [ ] Service-to-service auth enabled
#
# ==============================================================================
